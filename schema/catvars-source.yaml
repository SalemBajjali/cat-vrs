$schema: http://json-schema.org/draft/2020-12/schema
title: GA4GH-Categorical-Variation-Definitions
type: object
strict: true

imports:
  gks.core: core-source.yaml
  vrs: vrs-source.yaml

namespaces:
  vrs: vrs.json#/$defs/
  gks.core: core.json#/$defs/

$defs:
  # VRSATILE Categorical Variation are presented top-down. Everything rolls up to
  # CategoricalVariation, which is a polymorphic abstraction of many kinds of
  # categorical variation.

  # =============================================================================
  # Top-level Categorical Variation concepts
  # =============================================================================

  CategoricalVariation:
    inherits: gks.core:MappableEntity
    description: >-
      A representation of a categorically-defined domain for variation, in which individual 
      contextual variation instances may be members of the domain.
    heritableProperties:
      members:
        type: array
        ordered: false
        description: >-
          A non-exhaustive list of VRS variation contexts that satisfy the constraints of
          this categorical variant.
        items:
          anyOf:
            - $refCurie: vrs:Variation
            - $ref: "#/$defs/"

  CanonicalAllele:
    maturity: Alpha
    inherits: CategoricalVariation
    description: >-
      A canonical allele is defined by an `Allele <https://vrs.ga4gh.org/en/2.0/terms_and_model.html#variation>` 
      that is representative of a collection of congruent Alleles, each of which depict the same nucleic acid 
      change on different underlying reference sequences. Congruent representations of an Allele often exist
      across different genome assemblies and associated cDNA transcript representations.
    type: object
    properties:
      type:
        type: string
        const: "CanonicalAllele"
      definingContext:
        type:
          $refCurie: vrs:Variation
        description: >-
          The `VRS Variation <https://vrs.ga4gh.org/en/2.0/terms_and_model.html#variation>`_
          object that is congruent with variants on alternate reference sequences.
    required:
      - definingContext

  CategoricalCnv:
    maturity: Alpha
    type: object
    inherits: CategoricalVariation
    description: >-
      A categorical variation domain is defined first by a sequence derived from a canonical `Location 
      <https://vrs.ga4gh.org/en/2.0/terms_and_model.html#Location>`_ , which is representative of 
      a collection of congruent Locations. The change or count of this sequence is also described, either
      by a numeric value (e.g. "3 or more copies") or categorical representation (e.g. "high-level gain"). 
      Categorical CNVs may optionally be defined by rules specifying the location match characteristics for 
      member CNVs.
    properties:
      location:
        type:
          $refCurie: vrs:Location
        description: >-
          A `VRS Location <https://vrs.ga4gh.org/en/2.0/terms_and_model.html#location>`_
          object that represents a sequence derived from that location, and is congruent with locations 
          on alternate reference sequences.
      matchCharacteristic:
        type: string
        enum: ['exact', 'partial', 'subinterval', 'superinterval']
        description: >-
          The characteristics of a valid match between a contextual CNV location (the query) and the 
          Categorical CNV location (the domain), when both query and domain are represented on the same 
          reference sequence. An `exact` match requires the location of the query and domain to be identical. 
          A `subinterval` match requires the query to be a subinterval of the domain. A `superinterval` match
          requires the query to be a superinterval of the domain. A `partial` match requires at least 1 residue
          of overlap between the query and domain.
      copyChange:
        type: string
        enum: [ "efo:0030069", "efo:0020073", "efo:0030068", "efo:0030067", "efo:0030064", "efo:0030070", "efo:0030071", "efo:0030072" ]
        description: >-
          A representation of the change in copies of a sequence in a system. MUST be one of "efo:0030069" (complete 
          genomic loss), "efo:0020073" (high-level loss), "efo:0030068" (low-level loss), "efo:0030067" (loss), 
          "efo:0030064" (regional base ploidy), "efo:0030070" (gain), "efo:0030071" (low-level gain), "efo:0030072" 
          (high-level gain).
      copies:
        oneOf:
          - type: integer
          - $refCurie: vrs:Range
        description: >-
          The integral number of copies of the subject in a system.
    required:
      - location

#  CanonicalLocation:
#    inherits: Constraint
#    type: object
#    properties:
#      type:
#        type: string
#        const: "CanonicalLocation"
#      definingContext:
#        type:
#          $refCurie: vrs:Location
#        description: >-
#          The `VRS Location <https://vrs.ga4gh.org/en/2.0/terms_and_model.html#location>`_
#          object describing the location range for the categorical variant.
#      matchCharacteristic:
#        type: string
#        enum:
#          - exact
#          - partial
#          - complete


  # GeneContext:
  #   inherits: Constraint
  #   type: object
  #   properties:
  #     type:
  #       type: string
  #       const: "GeneContext"
  #     definingGene:
  #       description: >-
  #         The gene context for which variants must be evaluated.


  # ComplexVariation:
  #   type: object
  #   inherits: CategoricalVariation
  #   description: >-
  #     A categorical variation domain jointly characterized by two or more other categorical 
  #     variation domains.
  #   properties:
  #     type:
  #       type: string
  #       description: MUST be "ComplexVariation".
  #       const: ComplexVariation
  #     operands:
  #       type: array
  #       ordered: false
  #       items:
  #         $ref: "#/$defs/CategoricalVariation"
  #       minItems: 2
  #       description: >-
  #         The :ref:`CategoricalVariation` objects that are being evaluated collectively.
  #     operator:
  #       type: string
  #       enum: ["AND", "OR"]
  #       description: >-
  #         The logical operation applied to evaluating the object *operands*. MUST
  #         be "AND" or "OR".
  #   required: ["operands", "operator"]
